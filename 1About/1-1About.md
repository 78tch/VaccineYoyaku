# 1. システム概要  
## [戻る](https://github.com/78tch/VaccineYoyaku)　1.システム概要　→　[2.システムメッセージ文言](https://github.com/78tch/VaccineYoyaku/blob/main/2SystemMessage/2-1LINE.md)　→　[3.制限機能](https://github.com/78tch/VaccineYoyaku/blob/main/3Limit/Limit.md)　→　[4. 動作確認](https://github.com/78tch/VaccineYoyaku/blob/main/4Check/4-1Check.md) 　→　[5. コールセンター話法](https://github.com/78tch/VaccineYoyaku/blob/main/5CallCenter/5-1CallCenter.md)　→[6. 予約枠](https://github.com/78tch/VaccineYoyaku/blob/main/6Timetable/6-1Timetable.md)　→　[7. 設定切替](https://github.com/78tch/VaccineYoyaku/blob/main/7peration/7-1Operation.md)  
## 1-1.システムの構成  
PA社が開発し、「Salesforce.com」上に設置するシステムを採用。  
「Salesforce.com」は、V-SYSでも採用されている、顧客関係管理システムを中心としたクラウドコンピューティング・サービスである。（レンタルサーバー＋ミドルウェア、というイメージ。）  
　参考：[Salesforce.comのサイト](https://www.salesforce.com/jp/products/what-is-salesforce/)  
## 1-2.システムの機能  
前もって、市にて  
- 「対象者（接種券番号・生年月日）」  
- 「予約枠（会場・日付・時間帯・ワクチン種別（製造社、2回目接種間隔日数）・予約可能数：他）」  
を登録しておく。  
接種予約申込者は、  
  - Web版  
  - LINE版  
  - コールセンター版
  
の３通りのいずれかの方法により予約ができる。  
　システム画面で「接種券番号、生年月日」を入力し、「対象者」を照合して合致する者があれば、引き続き「電話番号、メールアドレス、希望予約枠」を入力することで予約ができる。  
　なお、LINE版は、「友だち登録」したうえで「フォームに入力」することで、５分後にシステム利用できるようになる。（５分間隔で同期しているため。事前登録を推奨する予定。）  
　市の公式LINEアカウントに「リッチメニュー」でシステムを表示させ、「トーク」で操作するが、処理自体はあくまで「Salesforce.com」上のシステムに投げかけられ、処理される。  
　これは、LINE の 「Massaging API」 による「Webhook」という仕組みである。（IE、Safari、ChromeなどのブラウザのようにLINEアプリは表示するのみ。）  
　また、通常であれば、公式LINEアカウントが１回メッセージ投稿するたびに5円などの料金が発生するが、今回「地方公共団体プラン」特例により、無制限無償とされた。  
　[LINE for Business 料金プラン](https://www.linebiz.com/jp/service/line-official-account/plan/)  
　[LINE 地方公共団体プラン](https://linecorp.com/ja/pr/news/ja/2019/2685)  
## 1-3.設定可能な項目  
- ワクチン種別ごとに、「２回目接種の間隔日数」を設定でき、１回の予約操作で、1回目接種の予約枠を選択すると、選択した予約枠だけでなく、2回目接種の予約枠も自動で予約登録される。（※そのことについて、分かりやすい案内文が必要である。）（２回目想定の「稼働日」は「予約開始までの日数」を空白にする）  
　なお、「間隔日数を0日」とすると、１回接種のワクチン、とみなされ2回目予約はされない。  
- 予約枠の受付可能数の内数として「コールセンターのみ予約可」なを設定可能。（「稼働日」の「予約枠あたりの優先接種者数」にて）  
　Web版、LINE版は、「○」か「×」としか表示されないが、コールセンター版は「3/5(1/3)」（ネットから2、コールセンターから1予約とり、ネットは「×」となっているがコールセンターはあと2取れる）などと表示される。  
　これを「その日の最後の枠のみ人数を減らす」等の個別枠ごと変更は、機能開発中。  
- 75歳以上のみ予約可（年度年齢制限）（設定方法確認中）  
- 満16歳以上のみ予約可（当日年齢制限）（「会場」の「年齢条件設定」にて）
- 予約当日の何日前から予約可とするか（「稼働日」の「予約開始までの日数」にて）  
- 予約当日の何日前から変更・キャンセル不可とするか（「稼働日」の「予約終了・変更までの日数」にて）
- 公開はするが予約は受け付けない（タイマーで解除可。予約受付開始日前にプレオープンするための機能。）
　などの制限設定が可能。（「アプリ設定」の「予約の無効化」にて）  
## 1-4.設定不可能な項目  
- 「単一の会場で複数ワクチンの並行は不可」  
　　現実のルールでもそうなので、ワクチンが複数となった場合には、注意が必要。  
- 「単一の会場で複数クールの並行は不可」  
  　ある会場のある予約枠（時間帯）において、「第１クールの２回目接種」の予約枠と「第２クールの１回目接種」の予約枠を混在させることはできない。  
  　この場合、実際には単一の会場であっても、「○○会場第１クール（奇数クール）」「○○会場第２クール（偶数クール）」などのように会場を分割登録することで対応する。  
- 「補欠、キャンセル待ち機能はない」  
　　キャンセルにより予約枠に空きが生じた場合に繰り上げる、というような機能はない。  
　　苦肉の策として、「会場名」を単に「キャンセル待ち」とすることで当日呼び出し候補者を募ろうとも考えたが、混乱を招きかねないことから断念した。  
- 「２回目接種のみのキャンセルは不可」  
　　振り替えをどうするのか等、対応が一律には不可能であることから、システム上では対応しきれない。「電話で相談して」という対応になる。  
## 1-5.データの構造  
- 「対象者」：姓、名、接種券番号、生年月日、電話番号、メールアドレスなどが格納できる。  
　　→初期値として、「接種券番号、生年月日」のみ登録する。「姓」がシステム上必須項目のため、「接種券番号」を再掲登録する。  
- 「会場」：設定項目は「会場名、所在地、予約枠の分間隔」。「会場名」が選択肢になるので命名規則に注意。  
- 「稼働日」：設定項目は「年月日、開始時刻、終了時刻、各予約枠の予約可能数・内数としてのコールセンターでの予約可能数、予約受付開始・終了・変更の受付を制限する日数」。「会場」ごとに登録する。ペアとなる２回接種日が必須。  
- 「予約枠」：設定項目は「開始時刻、終了時刻、枠自体の有効無効」。予約可能数を個別修正できるよう調整中。（対応不可なら、ダミー予約を前もって入れる）「会場・稼働日」ごとに、予約枠を登録する。  